# MUD 游戏函数详细文档

本文档详细介绍了 MUD 游戏项目中每个类及其方法的功能和作用。

## 1. 主程序入口

### Main.java
程序的入口点。

#### main(String[] args)
- **功能**：启动游戏主循环
- **参数**：args - 命令行参数
- **返回值**：无

## 2. 游戏控制类

### Game.java
游戏主控制器，协调各个服务模块的工作。

#### Game()
- **功能**：构造函数，初始化游戏所需的服务对象
- **参数**：无
- **返回值**：Game对象

#### start()
- **功能**：开始游戏，显示欢迎信息，处理登录或注册，进入主循环
- **参数**：无
- **返回值**：无

#### mainLoop()
- **功能**：游戏主循环，处理用户菜单选项
- **参数**：无
- **返回值**：无

#### showStatus()
- **功能**：显示玩家当前状态信息
- **参数**：无
- **返回值**：无

#### goTraining()
- **功能**：处理练功逻辑
- **参数**：无
- **返回值**：无

#### goTrainingSweep()
- **功能**：处理扫荡练功逻辑
- **参数**：无
- **返回值**：无

#### goBattle()
- **功能**：处理战斗逻辑
- **参数**：无
- **返回值**：无

#### saveAndExit()
- **功能**：保存游戏并退出
- **参数**：无
- **返回值**：无

#### exitWithoutSaving()
- **功能**：不保存直接退出游戏
- **参数**：无
- **返回值**：无

#### checkRoundLimit()
- **功能**：检查是否超出回合限制（100回合）
- **参数**：无
- **返回值**：boolean - 是否超出回合限制

#### checkDominance()
- **功能**：检查是否达到称霸武林条件（1200战力）
- **参数**：无
- **返回值**：无

#### consumeTrainingRound()
- **功能**：练功时消耗回合的回调函数
- **参数**：无
- **返回值**：boolean - true表示可以继续练功，false表示回合耗尽需要中断

## 3. 枚举类

### Difficulty.java
定义游戏难度等级。

#### EASY
- **功能**：简单难度
- **属性**：属性系数0.8，血量系数0.9，奖励倍数5

#### NORMAL
- **功能**：普通难度
- **属性**：属性系数1.0，血量系数1.0，奖励倍数10

#### HARD
- **功能**：困难难度
- **属性**：属性系数1.3，血量系数1.2，奖励倍数15

#### HELL
- **功能**：地狱难度
- **属性**：属性系数1.8，血量系数1.5，奖励倍数25

#### getName()
- **功能**：获取难度名称
- **参数**：无
- **返回值**：String - 难度名称

#### getDisplayName()
- **功能**：获取显示名称
- **参数**：无
- **返回值**：String - 显示名称

#### getStatsMultiplier()
- **功能**：获取属性系数
- **参数**：无
- **返回值**：double - 属性系数

#### getHpMultiplier()
- **功能**：获取血量系数
- **参数**：无
- **返回值**：double - 血量系数

#### getRewardMultiplier()
- **功能**：获取奖励倍数
- **参数**：无
- **返回值**：int - 奖励倍数

### SkillType.java
定义武学流派类型。

#### SABER
- **功能**：刀法流派
- **属性**：每级攻击加成5

#### SWORD
- **功能**：剑法流派
- **属性**：每级攻击加成6

#### FIST
- **功能**：拳法流派
- **属性**：每级攻击加成4

#### getName()
- **功能**：获取技能名称
- **参数**：无
- **返回值**：String - 技能名称

#### getAttackBonusPerLevel()
- **功能**：获取每级攻击加成
- **参数**：无
- **返回值**：int - 每级攻击加成

#### counters(SkillType other)
- **功能**：判断是否克制另一个技能类型（剑克刀，刀克拳，拳克剑）
- **参数**：other - 另一个技能类型
- **返回值**：boolean - 是否克制

### BattleResult.java
定义战斗结果类型。

#### WIN
- **功能**：玩家胜利

#### LOSE
- **功能**：玩家失败

#### getName()
- **功能**：获取结果名称
- **参数**：无
- **返回值**：String - 结果名称

## 4. 数据模型类

### Stats.java
角色属性数据模型。

#### Stats()
- **功能**：默认构造函数，使用基础属性值
- **参数**：无
- **返回值**：Stats对象

#### Stats(int str, int agi, int con, int intel, int luk)
- **功能**：带参构造函数，初始化各项属性
- **参数**：
  - str：力量
  - agi：敏捷
  - con：体质
  - intel：智力
  - luk：幸运
- **返回值**：Stats对象

#### calculateMaxHP(int con)
- **功能**：计算最大生命值
- **参数**：con - 体质
- **返回值**：int - 最大生命值

#### recalcHpMax()
- **功能**：重新计算最大生命值
- **参数**：无
- **返回值**：无

#### restoreFullHp()
- **功能**：恢复全部生命值
- **参数**：无
- **返回值**：无

#### takeDamage(int damage)
- **功能**：受到伤害
- **参数**：damage - 伤害值
- **返回值**：无

#### clone()
- **功能**：克隆当前Stats对象
- **参数**：无
- **返回值**：Stats - 克隆的对象

#### addRandomAttribute(int points)
- **功能**：随机增加属性点（可以是负数，用于惩罚）
- **参数**：points - 属性点数
- **返回值**：无

#### isAlive()
- **功能**：判断是否存活（生命值大于0）
- **参数**：无
- **返回值**：boolean - 是否存活

### Skill.java
技能数据模型。

#### Skill(SkillType type)
- **功能**：构造函数，初始化技能类型
- **参数**：type - 技能类型
- **返回值**：Skill对象

#### Skill(SkillType type, int level, int exp)
- **功能**：构造函数，初始化技能类型、等级和经验
- **参数**：
  - type - 技能类型
  - level - 技能等级
  - exp - 当前经验
- **返回值**：Skill对象

#### addExp(int value)
- **功能**：增加经验并检查是否升级
- **参数**：value - 增加的经验值
- **返回值**：boolean - 是否升级

#### calculateExpNeededForLevel(int level)
- **功能**：计算升级到指定等级所需经验
- **参数**：level - 等级
- **返回值**：int - 所需经验

#### checkLevelUp()
- **功能**：检查是否可以升级
- **参数**：无
- **返回值**：boolean - 是否升级

#### getAttackBonus()
- **功能**：获取当前攻击加成
- **参数**：无
- **返回值**：int - 攻击加成

#### getExpNeededForNextLevel()
- **功能**：获取升级所需经验
- **参数**：无
- **返回值**：int - 升级所需经验

#### getDisplayName()
- **功能**：获取技能显示名称
- **参数**：无
- **返回值**：String - 显示名称

#### getExpProgress()
- **功能**：获取经验进度描述
- **参数**：无
- **返回值**：String - 经验进度

### CharacterBase.java
角色基类，包含通用的角色属性和方法。

#### CharacterBase(String name, Stats stats, Skill mainSkill)
- **功能**：构造函数，初始化角色基本信息
- **参数**：
  - name - 角色名称
  - stats - 属性
  - mainSkill - 主要技能
- **返回值**：CharacterBase对象

#### calculateBaseAttack(int str, int attackBonus)
- **功能**：计算基础攻击力
- **参数**：
  - str - 力量
  - attackBonus - 攻击加成
- **返回值**：int - 基础攻击力

#### calculateBaseDefense(int con)
- **功能**：计算基础防御力
- **参数**：con - 体质
- **返回值**：int - 基础防御力

#### calculateSpeed(int agi)
- **功能**：计算速度
- **参数**：agi - 敏捷
- **返回值**：int - 速度

#### calculateHitRate(CharacterBase attacker, CharacterBase defender)
- **功能**：计算命中率
- **参数**：
  - attacker - 攻击者
  - defender - 防御者
- **返回值**：int - 命中率

#### calculateCritRate(int luk)
- **功能**：计算暴击率
- **参数**：luk - 幸运
- **返回值**：int - 暴击率

#### calcAttack()
- **功能**：计算攻击力
- **参数**：无
- **返回值**：int - 攻击力

#### calcDefense()
- **功能**：计算防御力
- **参数**：无
- **返回值**：int - 防御力

#### calcSpeed()
- **功能**：计算速度
- **参数**：无
- **返回值**：int - 速度

#### calcHitRate(CharacterBase target)
- **功能**：计算对目标的命中率
- **参数**：target - 目标
- **返回值**：int - 命中率

#### calcCritRate()
- **功能**：计算暴击率
- **参数**：无
- **返回值**：int - 暴击率

#### isAlive()
- **功能**：判断角色是否存活
- **参数**：无
- **返回值**：boolean - 是否存活

#### takeDamage(int damage)
- **功能**：承受伤害
- **参数**：damage - 伤害值
- **返回值**：无

#### restoreFullHp()
- **功能**：恢复全部生命值
- **参数**：无
- **返回值**：无

#### attack(CharacterBase target)
- **功能**：攻击目标角色
- **参数**：target - 目标角色
- **返回值**：int - 造成的伤害值

#### getStatus()
- **功能**：获取角色状态描述
- **参数**：无
- **返回值**：String - 状态描述

### Player.java
玩家角色类，继承自CharacterBase。

#### Player(String name, String username, Stats stats)
- **功能**：构造函数，初始化玩家信息
- **参数**：
  - name - 角色名
  - username - 用户名
  - stats - 属性
- **返回值**：Player对象

#### calculatePower(int str, int agi, int con, int intel, int luk, int saberLevel, int swordLevel, int fistLevel)
- **功能**：计算战力
- **参数**：
  - str - 力量
  - agi - 敏捷
  - con - 体质
  - intel - 智力
  - luk - 幸运
  - saberLevel - 刀法等级
  - swordLevel - 剑法等级
  - fistLevel - 拳法等级
- **返回值**：int - 战力值

#### recalcPower()
- **功能**：重新计算战力
- **参数**：无
- **返回值**：无

#### updateTitle()
- **功能**：更新称号
- **参数**：无
- **返回值**：无

#### setMainStyle(SkillType style)
- **功能**：切换主用流派
- **参数**：style - 流派类型
- **返回值**：无

#### getSkill(SkillType type)
- **功能**：获取指定技能
- **参数**：type - 技能类型
- **返回值**：Skill - 对应的技能对象

#### addAttributePoint(String attributeName, int points)
- **功能**：增加属性点
- **参数**：
  - attributeName - 属性名称
  - points - 增加的点数
- **返回值**：boolean - 是否成功

#### getSkills()
- **功能**：获取技能等级映射（用于战力计算）
- **参数**：无
- **返回值**：Map<String, Integer> - 技能等级映射

#### trainSkill(SkillType type, int expGain)
- **功能**：提升技能等级
- **参数**：
  - type - 技能类型
  - expGain - 获得的经验
- **返回值**：boolean - 是否升级

#### gainBattleRewards(int powerBonus)
- **功能**：获取战斗奖励
- **参数**：powerBonus - 战力奖励
- **返回值**：无

#### isDominanceAchieved(int power)
- **功能**：检查是否达到称霸武林条件
- **参数**：power - 战力
- **返回值**：boolean - 是否达到条件

#### isDominant()
- **功能**：检查玩家是否已称霸武林
- **参数**：无
- **返回值**：boolean - 是否称霸武林

#### incrementRound()
- **功能**：增加回合数
- **参数**：无
- **返回值**：无

#### getStatus()
- **功能**：获取玩家详细状态
- **参数**：无
- **返回值**：String - 玩家状态

### Npc.java
NPC角色类，继承自CharacterBase。

#### Npc(String name, Difficulty difficulty, SkillType skillType, Stats stats, String title)
- **功能**：构造函数，初始化NPC信息
- **参数**：
  - name - NPC名称
  - difficulty - 难度等级
  - skillType - 技能类型
  - stats - 属性
  - title - 称号
- **返回值**：Npc对象

#### calculateBaseAttribute(int playerPower, Difficulty difficulty)
- **功能**：计算NPC的基础属性值
- **参数**：
  - playerPower - 玩家战力
  - difficulty - 难度
- **返回值**：int - 基础属性值

#### generateNpcStats(int baseAttribute, Difficulty difficulty)
- **功能**：生成NPC的属性
- **参数**：
  - baseAttribute - 基础属性
  - difficulty - 难度
- **返回值**：Stats - NPC属性

#### generateNpcName(SkillType skillType)
- **功能**：生成NPC名称
- **参数**：skillType - 技能类型
- **返回值**：String - NPC名称

#### generateNpcTitle(Difficulty difficulty, SkillType skillType)
- **功能**：生成NPC称号
- **参数**：
  - difficulty - 难度
  - skillType - 技能类型
- **返回值**：String - NPC称号

#### calculatePower()
- **功能**：计算NPC战力
- **参数**：无
- **返回值**：int - NPC战力

#### getDisplayName()
- **功能**：获取NPC的显示名称
- **参数**：无
- **返回值**：String - 显示名称

#### getDescription()
- **功能**：获取NPC的描述
- **参数**：无
- **返回值**：String - NPC描述

## 5. 工具类

### RandomUtils.java
随机数工具类。

#### getRandomInt(int min, int max)
- **功能**：获取指定范围内的随机整数 [min, max]
- **参数**：
  - min - 最小值（包含）
  - max - 最大值（包含）
- **返回值**：int - 随机整数

#### isSuccess(int probability)
- **功能**：根据概率判断是否成功
- **参数**：probability - 成功率（0-100）
- **返回值**：boolean - 是否成功

#### getRandomElement(T[] array)
- **功能**：随机选择一个元素
- **参数**：array - 元素数组
- **返回值**：T - 随机选取的元素

#### getCritDamageMultiplier()
- **功能**：获取随机暴击伤害倍数
- **参数**：无
- **返回值**：double - 暴击伤害倍数

#### getNormalDamageMultiplier()
- **功能**：获取随机普通伤害倍数
- **参数**：无
- **返回值**：double - 普通伤害倍数

### ConsoleIO.java
控制台输入输出工具类。

#### print(String message)
- **功能**：打印消息（不换行）
- **参数**：message - 要打印的消息
- **返回值**：无

#### println(String message)
- **功能**：打印消息（换行）
- **参数**：message - 要打印的消息
- **返回值**：无

#### printSeparator()
- **功能**：打印分隔线
- **参数**：无
- **返回值**：无

#### printTitle(String title)
- **功能**：打印标题
- **参数**：title - 标题
- **返回值**：无

#### readLine()
- **功能**：读取用户输入的一行
- **参数**：无
- **返回值**：String - 用户输入的内容

#### readInt(String prompt)
- **功能**：读取用户输入的整数
- **参数**：prompt - 提示信息
- **返回值**：int - 用户输入的整数

#### readChoice(int maxChoice, String prompt)
- **功能**：读取用户输入的选择（1-n之间的整数）
- **参数**：
  - maxChoice - 最大选择数
  - prompt - 提示信息
- **返回值**：int - 用户输入的选择

#### confirm(String prompt)
- **功能**：读取用户的确认（y/n）
- **参数**：prompt - 提示信息
- **返回值**：boolean - 用户确认结果

#### waitForEnter()
- **功能**：等待用户按回车键继续
- **参数**：无
- **返回值**：无

#### clearConsole()
- **功能**：清空控制台（模拟）
- **参数**：无
- **返回值**：无

#### printBattleEffect(String attackerName, String skillName, String targetName, int damage, boolean isCritical, boolean isCounter)
- **功能**：打印战斗效果文本
- **参数**：
  - attackerName - 攻击者名称
  - skillName - 技能名称
  - targetName - 目标名称
  - damage - 伤害值
  - isCritical - 是否暴击
  - isCounter - 是否克制
- **返回值**：无

#### printMessage(String message)
- **功能**：打印消息
- **参数**：message - 消息内容
- **返回值**：无

#### printErrorMessage(String message)
- **功能**：打印错误消息
- **参数**：message - 错误消息内容
- **返回值**：无

#### printSuccessMessage(String message)
- **功能**：打印成功消息
- **参数**：message - 成功消息内容
- **返回值**：无

#### readInput(String prompt)
- **功能**：读取用户输入
- **参数**：prompt - 提示信息
- **返回值**：String - 用户输入内容

#### readInput()
- **功能**：读取用户输入（无提示）
- **参数**：无
- **返回值**：无

#### printWelcomeMessage()
- **功能**：打印欢迎消息
- **参数**：无
- **返回值**：无

#### printMainMenu()
- **功能**：打印主菜单
- **参数**：无
- **返回值**：无

#### printBattleDifficultyMenu()
- **功能**：打印战斗难度菜单
- **参数**：无
- **返回值**：无

#### printPlayerStatus(Player player)
- **功能**：打印玩家状态
- **参数**：player - 玩家对象
- **返回值**：无

#### readIntInput(String prompt, int min, int max)
- **功能**：读取指定范围内的整数输入
- **参数**：
  - prompt - 提示信息
  - min - 最小值
  - max - 最大值
- **返回值**：int - 用户输入的整数

#### confirmAction(String prompt)
- **功能**：确认操作
- **参数**：prompt - 提示信息
- **返回值**：boolean - 确认结果

#### pressEnterToContinue()
- **功能**：按回车键继续
- **参数**：无
- **返回值**：无

## 6. 服务类

### NpcFactory.java
NPC工厂类，用于生成不同难度的NPC。

#### createNpc(Difficulty difficulty, int playerPower)
- **功能**：根据难度生成NPC
- **参数**：
  - difficulty - 难度
  - playerPower - 玩家战力
- **返回值**：Npc - 生成的NPC

#### calculateBaseAttribute(int playerPower, Difficulty difficulty)
- **功能**：计算NPC的基础属性值
- **参数**：
  - playerPower - 玩家战力
  - difficulty - 难度
- **返回值**：int - 基础属性值

#### generateNpcStats(int baseAttribute, Difficulty difficulty)
- **功能**：生成NPC的属性
- **参数**：
  - baseAttribute - 基础属性
  - difficulty - 难度
- **返回值**：Stats - NPC属性

#### generateNpcName(SkillType skillType)
- **功能**：生成NPC名称
- **参数**：skillType - 技能类型
- **返回值**：String - NPC名称

#### generateNpcTitle(Difficulty difficulty, SkillType skillType)
- **功能**：生成NPC称号
- **参数**：
  - difficulty - 难度
  - skillType - 技能类型
- **返回值**：String - NPC称号

#### getNpcDisplayName(Difficulty difficulty, String title, String name, SkillType skillType)
- **功能**：获取NPC的显示名称
- **参数**：
  - difficulty - 难度
  - title - 称号
  - name - 名称
  - skillType - 技能类型
- **返回值**：String - 显示名称

#### getNpcDescription(Difficulty difficulty)
- **功能**：获取NPC的描述
- **参数**：difficulty - 难度
- **返回值**：String - NPC描述

### BattleService.java
战斗服务类，处理战斗逻辑。

#### setAutoBattle(boolean auto)
- **功能**：设置自动战斗模式
- **参数**：auto - 是否自动战斗
- **返回值**：无

#### fight(Player player, Npc npc)
- **功能**：进行一场战斗
- **参数**：
  - player - 玩家对象
  - npc - NPC对象
- **返回值**：BattleResult - 战斗结果

#### executeAttack(CharacterBase attacker, CharacterBase defender)
- **功能**：执行一次攻击
- **参数**：
  - attacker - 攻击者
  - defender - 防御者
- **返回值**：无

#### showBattleStatus(Player player, Npc npc)
- **功能**：显示战斗状态
- **参数**：
  - player - 玩家对象
  - npc - NPC对象
- **返回值**：无

#### determineBattleResult(Player player, Npc npc)
- **功能**：确定战斗结果
- **参数**：
  - player - 玩家对象
  - npc - NPC对象
- **返回值**：BattleResult - 战斗结果

### TrainingService.java
练功服务类，处理练功逻辑。

#### train(Player player, Supplier<Boolean> roundConsumer)
- **功能**：开始练功
- **参数**：
  - player - 玩家对象
  - roundConsumer - 用于消耗回合数的回调，返回false表示回合耗尽需要立即停止
- **返回值**：无

#### showSkillInfo(Player player)
- **功能**：显示技能信息
- **参数**：player - 玩家对象
- **返回值**：无

#### selectSkillToTrain(Player player)
- **功能**：选择要修炼的技能
- **参数**：player - 玩家对象
- **返回值**：SkillType - 选择的技能类型

#### performTraining(Player player, SkillType skillType)
- **功能**：执行一次练功
- **参数**：
  - player - 玩家对象
  - skillType - 技能类型
- **返回值**：无

#### showTrainingDescription(SkillType skillType)
- **功能**：显示练功描述
- **参数**：skillType - 技能类型
- **返回值**：无

#### calculateSuccessRate(Player player, SkillType skillType)
- **功能**：计算练功成功率
- **参数**：
  - player - 玩家对象
  - skillType - 技能类型
- **返回值**：int - 成功率

#### sweepTrain(Player player, SkillType skillType, int rounds, Supplier<Boolean> roundConsumer)
- **功能**：扫荡练功
- **参数**：
  - player - 玩家对象
  - skillType - 技能类型
  - rounds - 回合数
  - roundConsumer - 用于消耗回合数的回调
- **返回值**：无

### LoginService.java
登录服务类，处理用户登录和注册。

#### LoginService(SaveLoadService saveLoadService)
- **功能**：构造函数，初始化登录服务
- **参数**：saveLoadService - 存档加载服务
- **返回值**：LoginService对象

#### loginOrRegister()
- **功能**：登录或注册用户
- **参数**：无
- **返回值**：Player - 登录或创建的玩家对象

#### createNewPlayer(String username)
- **功能**：创建新玩家
- **参数**：username - 用户名
- **返回值**：Player - 新玩家对象

#### allocateAttributes()
- **功能**：分配属性点
- **参数**：无
- **返回值**：Stats - 分配后的属性

#### showAttributeStatus(int str, int agi, int con, int intel, int luk, int remainingPoints)
- **功能**：显示当前属性状态
- **参数**：
  - str - 力量
  - agi - 敏捷
  - con - 体质
  - intel - 智力
  - luk - 幸运
  - remainingPoints - 剩余点数
- **返回值**：无

#### chooseMainStyle()
- **功能**：选择主用流派
- **参数**：无
- **返回值**：SkillType - 选择的流派

#### userExists(String username)
- **功能**：检查用户是否存在
- **参数**：username - 用户名
- **返回值**：boolean - 用户是否存在

#### registerUser(String username)
- **功能**：注册新用户
- **参数**：username - 用户名
- **返回值**：boolean - 是否注册成功

#### authenticateUser(String username)
- **功能**：验证用户
- **参数**：username - 用户名
- **返回值**：boolean - 验证是否成功

### SaveLoadService.java
存档服务类，处理游戏存档和读档。

#### SaveLoadService()
- **功能**：构造函数，初始化存档服务
- **参数**：无
- **返回值**：SaveLoadService对象

#### save(Player player)
- **功能**：保存玩家数据
- **参数**：player - 玩家对象
- **返回值**：boolean - 保存是否成功

#### load(String username)
- **功能**：加载玩家数据
- **参数**：username - 用户名
- **返回值**：Player - 加载的玩家对象，如果失败则返回null

#### saveExists(String username)
- **功能**：检查存档是否存在
- **参数**：username - 用户名
- **返回值**：boolean - 存档是否存在

#### getSaveFilePath(String username)
- **功能**：获取存档文件路径
- **参数**：username - 用户名
- **返回值**：String - 存档文件路径

#### deleteSave(String username)
- **功能**：删除存档
- **参数**：username - 用户名
- **返回值**：boolean - 删除是否成功