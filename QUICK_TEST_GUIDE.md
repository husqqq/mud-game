# 快速测试指南

## 🚀 5分钟完成压力测试

### 第1步：打开两个终端窗口

```
┌─────────────────┐    ┌─────────────────┐
│   终端 1        │    │   终端 2        │
│   (服务器)      │    │   (测试客户端)   │
└─────────────────┘    └─────────────────┘
```

### 第2步：在终端1启动服务器

```batch
cd D:\Java_work\MUD
run.bat
```

**会看到提示**：
```
========================================
欢迎来到多人武侠MUD游戏！
========================================
1. 单人模式
2. 多人模式
请选择游戏模式 (1/2):
```

**输入 `2` 并回车**（选择多人模式）

**然后会提示**：
```
请输入玩家数量 (2-10):
```

**输入 `8` 并回车**（⚠️ 重要：必须输入8，因为测试最多创建8个客户端）

**最后看到**：
```
多人游戏服务器已启动，端口：12345
等待玩家连接...
```

✅ 服务器启动成功！保持此窗口运行。

⚠️ **重要说明**：
- 服务器玩家数必须设置为 **8**
- 测试会在每轮固定创建 **8 个客户端**
- 如果服务器设置为其他数量（如10），游戏会一直等待剩余玩家连接
- 只有当连接的客户端数 = 服务器设置的玩家数时，游戏才会开始
- **服务器玩家数 ≠ 8** → 测试会卡住等待 ❌

### 第3步：在终端2运行测试

```batch
cd D:\Java_work\MUD
run_stress_test.bat
```

按提示操作后，测试将自动运行。

### 第4步：观察测试结果

**终端2 会显示**：
```
========================================
多人游戏压力测试
========================================

检查服务器连接...
服务器连接正常！

========================================
第 1 轮测试：5 个客户端
========================================
[客户端 1] 开始连接...
[客户端 2] 开始连接...
...
[客户端 1] 测试完成
[客户端 2] 测试完成
...

========================================
测试完成！
========================================
成功操作数: 25
错误操作数: 0
```

**终端1 (服务器) 会显示**：
```
新客户端连接: /127.0.0.1:xxxxx
玩家 test_user_xxx_1 注册成功
玩家 test_user_xxx_1 登录成功
玩家 Player_1 创建成功
...
```

## 📊 理解测试结果

### ✅ 测试成功

- **成功操作数 > 0**
- **错误操作数 = 0** 或很少
- 服务器正常处理所有连接
- 没有死锁或崩溃

### ⚠️ 需要关注

- **错误操作数 > 5**：可能有并发问题
- **连接被拒绝**：检查服务器是否正常运行
- **测试超时**：可能有死锁

### ❌ 测试失败

- 所有客户端都无法连接：服务器未启动
- 频繁出现异常：代码有bug
- 测试卡死：存在死锁

## 🔧 常见问题

### 问题1：连接被拒绝

```
错误: Connection refused: connect
```

**解决方案**：
1. 确保终端1的服务器正在运行
2. 检查端口12345是否被占用
3. 尝试重启服务器

### 问题2：编译失败

**解决方案**：
```batch
# 手动编译所有文件
cd D:\Java_work\MUD
javac -d bin -encoding UTF-8 src\*.java src\client\*.java src\server\*.java src\network\*.java src\io\*.java src\test\*.java
```

### 问题3：测试结果不理想

**调整参数**（编辑 `src/test/MultiPlayerStressTest.java`）：

```java
// 减少客户端数量（更容易通过）
private static final int MAX_CLIENTS = 4;

// 减少测试轮次
int totalRounds = 3;

// 减少每个客户端的操作次数
int numActions = 2 + random.nextInt(2); // 2-3个操作
```

## 📝 测试检查清单

使用此清单验证系统稳定性：

- [ ] 服务器能正常启动
- [ ] 2个客户端并发测试通过
- [ ] 4个客户端并发测试通过
- [ ] 8个客户端并发测试通过
- [ ] 多轮测试后无内存泄漏
- [ ] 决斗池（PvP）功能正常
- [ ] 没有死锁或线程阻塞
- [ ] 错误率 < 5%

## 🎯 压力级别

| 客户端数 | 难度 | 说明 |
|---------|------|------|
| 2-3 | 简单 | 基础并发测试 |
| 4-6 | 中等 | 常规压力测试 |
| 8-10 | 困难 | 高并发测试 |
| 16+ | 极限 | 压力上限测试 |

## 💡 优化建议

根据测试结果优化系统：

1. **如果错误率 > 10%**：
   - 检查线程安全问题
   - 增加同步机制
   - 优化锁的使用

2. **如果测试超时**：
   - 检查是否有死锁
   - 优化 wait/notify 逻辑
   - 增加超时保护

3. **如果连接不稳定**：
   - 检查 Socket 管理
   - 优化心跳机制
   - 增加重连逻辑

## 🔄 完整测试流程

```
1. 清理旧数据
   ├── 删除 userdata/*.dat
   └── 删除 saves/*.sav

2. 启动服务器
   └── run.bat

3. 运行测试
   ├── run_stress_test.bat
   └── 观察结果

4. 分析结果
   ├── 查看成功率
   ├── 检查错误日志
   └── 观察服务器行为

5. 修复问题（如有）
   ├── 修改代码
   ├── 重新编译
   └── 重新测试

6. 重复 2-5 直到测试通过
```

## 📖 更多信息

详细文档：`TEST_README.md`

---

**祝测试顺利！** 🎉
