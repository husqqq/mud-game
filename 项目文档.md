# MUD 游戏项目文档

## 1. 项目概览

### 1.1 游戏简介
这是一款命令行武侠养成类 MUD。玩家通过登录/注册进入江湖，分配属性、选择流派、在后山练功或与 NPC 切磋，最终目标是在限定回合内达到 1200 战力，成为武林霸主。

### 1.2 当前版本特性
- 五维属性（力量、敏捷、体质、智力、幸运）+ 三大流派（刀/剑/拳）的成长体系
- 100 回合硬性限制：**每次练功记 1 回合**，战斗也会额外消耗 1 回合；超过 100 回合直接失败
- 场景化的练功描述与随机奖励（成功获得 1~5 点随机属性，主流派额外 +20% 向上取整）
- 随机生成的 NPC（难度 + 属性 + 流派克制）
- 完整的存档/读档系统（基于 Java 序列化）
- 五种称号系统（初入江湖、武林新秀、江湖豪侠、一代宗师、武林霸主）

## 2. 目录结构

当前代码全部位于默认包下，IDEA 直接将 `src` 标为 Source Root 即可：

```
MUD/
├── run_game.bat
├── 项目文档.md
└── src/
    ├── Main.java              # 程序入口
    ├── Game.java              # 游戏总控
    ├── Difficulty.java        # 难度枚举
    ├── SkillType.java         # 武学枚举
    ├── BattleResult.java      # 战斗结果枚举
    ├── Stats.java             # 属性模型
    ├── Skill.java             # 技能模型
    ├── CharacterBase.java     # 角色基类
    ├── Player.java            # 玩家模型（含回合数）
    ├── Npc.java               # NPC 模型
    ├── RandomUtils.java       # 随机工具
    ├── ConsoleIO.java         # 控制台交互
    ├── NpcFactory.java        # NPC 工厂
    ├── BattleService.java     # 战斗服务
    ├── TrainingService.java   # 练功服务（支持回合回调）
    ├── LoginService.java      # 登录/注册服务
    └── SaveLoadService.java   # 存档/读档服务
```

## 3. 架构与核心交互

- **表示层**：`ConsoleIO` 负责所有输入/输出提示。
- **业务层**：`Game` 调度 `LoginService`、`TrainingService`、`BattleService` 等实现全部玩法。
- **数据层**：`SaveLoadService` 统一处理序列化存档；`Stats/Skill/Player/Npc` 等负责状态与计算。

核心调用关系（简写）：

```
Main → Game
Game → {ConsoleIO, LoginService, TrainingService, BattleService, NpcFactory, SaveLoadService}
BattleService → {RandomUtils, ConsoleIO}
TrainingService → {RandomUtils, ConsoleIO}
Player → {Stats, Skill}
NpcFactory → {RandomUtils, Npc}
```

## 4. 关键模块说明

| 模块 | 说明 |
| --- | --- |
| 登录/注册 | `LoginService` 负责用户注册、验证、角色创建及属性分配。 |
| 练功系统 | `TrainingService` 支持普通练功与“一键扫荡”两种模式；智力影响成功率，主流派额外 +10% 成功率、成功奖励 +20%（向上取整），失败扣 5~10 点属性。 |
| 战斗系统 | `BattleService` 实现回合制战斗与流派克制；战斗结束自动处理奖励/惩罚并消耗 1 回合。 |
| NPC 生成 | `NpcFactory` 根据玩家战力与难度动态生成 NPC 属性和称号，NPC强度已调整为原60%，更易战胜。当地狱难度下玩家战力超过1100时，NPC强度将不再继续增长，确保1100战力的玩家能够击败地狱难度NPC。 |
| 存档系统 | `SaveLoadService` 使用序列化保存完整 `Player` 对象（含战力、属性、技能、回合数）。 |
| 回合限制 | `Game` 统一管理回合；`Player` 持有 `roundCount`，`checkRoundLimit()` 统一判定失败。 |

## 5. 数据模型摘要

- `Stats`：保存五维属性与生命值，提供加点、伤害、恢复等操作。
- `Skill`：保存流派、等级、经验与攻击加成。
- `CharacterBase`：抽象出所有角色共用的战斗计算方法。
- `Player`：扩展用户名、技能映射、称号、战力与 **roundCount**。
- `Npc`：持有难度、称号、主技能及随机属性。

## 6. 游戏流程（含回合规则）

1. **启动**：运行 `run_game.bat`，进入登录/注册流程。
2. **角色创建**：分配 5 点自由属性，选择主流派。
3. **主菜单循环**（最多 100 回合）：
   - 查看状态（不消耗回合）
   - 去后山练功：**每次练功尝试强制消耗 1 回合**；若为主流派，成功率 +10%、奖励 +20%；失败扣 5~10 属性
   - 一键扫荡练功：提前选定流派与回合数，批量练功并逐次扣回合，遇到回合耗尽会自动终止
   - 下山切磋：整场战斗结束后额外消耗 1 回合
   - 保存并退出 / 直接退出
4. **胜负条件**：
   - **胜利**：在 ≤100 回合且战力 ≥1200
   - **失败**：超过 100 回合无论战力多少都失败
5. **存档**：手动保存或结局时自动保存。
